<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Active Users - LendScape</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/top_users.css') }}">
</head>

<body>

<!-- Navigation -->
<nav class="navbar">
    <div class="nav-container">
        <a href="/" class="logo">üì¶ LendScape</a>
        <div class="nav-menu">
            <a href="{{ url_for('items.search_page') }}">Browse Items</a>
            <a href="{{ url_for('items.map_page') }}">Items Map</a>
            {% if current_user %}
            <a href="{{ url_for('items.create_item_page') }}">Create Item</a>
            {% endif %}
            <a href="{{ url_for('stats.top_users_page') }}" class="active">Top Users</a>
        </div>
        <div class="nav-buttons">
            {% if current_user %}
            <div class="user-info">
                <span class="user-name">Hello, {{ current_user.firstName }}</span>
                <div class="user-avatar" onclick="toggleDropdown(event)">
                    {{ current_user.firstName[0] }}{{ current_user.lastName[0] if current_user.lastName else '' }}
                    <div class="dropdown-menu" id="dropdownMenu">
                        <a href="{{ url_for('users.user_detail_page', userid=user_id) }}">My Profile</a>
                        <a href="{{ url_for('items.create_item_page') }}">Create Item</a>
                        <a href="{{ url_for('users.user_detail_page', userid=user_id) }}?section=items">My Items</a>
                        <div class="divider"></div>
                        <a onclick="logout()" class="logout">Logout</a>
                    </div>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('auth.login_page') }}" class="btn btn-outline">Sign In</a>
            <a href="{{ url_for('auth.login_page') }}" class="btn btn-primary">Get Started</a>
            {% endif %}
        </div>
    </div>
</nav>

<!-- Main Container -->
<div class="main-container">

    <!-- Hero Section -->
    <section class="hero-section">
        <h1>üèÜ Top Active Users</h1>
        <p>Our most engaged community members</p>
        <div class="hero-stats">
            <div class="hero-stat">
                <span class="stat-value" id="total-users-count">--</span>
                <span class="stat-label">Total Users</span>
            </div>
            <div class="hero-stat">
                <span class="stat-value" id="active-users-count">--</span>
                <span class="stat-label">Active Users</span>
            </div>
            <div class="hero-stat">
                <span class="stat-value" id="avg-activity-score">--</span>
                <span class="stat-label">Avg Activity Score</span>
            </div>
        </div>
    </section>

    <!-- Filter Section -->
    <section class="filter-section">
        <div class="filter-container">
            <div class="filter-group">
                <label for="minScoreFilter">Minimum Activity Score:</label>
                <input type="number" id="minScoreFilter" placeholder="e.g., 5" min="0" step="0.1">
            </div>
            <div class="filter-actions">
                <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                <button class="btn btn-secondary" onclick="clearFilters()">Clear</button>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="results-section">
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Loading top users...</p>
        </div>

        <!-- Top 3 Users - Podium Style -->
        <div id="podium-section" class="podium-section" style="display: none;">
            <h2 class="section-title">ü•á Hall of Fame - Top 3</h2>
            <div class="podium-container" id="podium-container">
                <!-- Top 3 users will be inserted here -->
            </div>
        </div>

        <!-- Top 4-10 Users -->
        <div id="top-ten-section" class="top-ten-section" style="display: none;">
            <h2 class="section-title">‚≠ê Top 10 Leaders</h2>
            <div class="top-ten-container" id="top-ten-container">
                <!-- Top 4-10 users will be inserted here -->
            </div>
        </div>

        <!-- Rest of Users -->
        <div id="other-users-section" class="other-users-section" style="display: none;">
            <h2 class="section-title">üë• All Active Users</h2>
            <div class="other-users-container" id="other-users-container">
                <!-- Other users will be inserted here -->
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-icon">üîç</div>
            <div class="empty-title">No Users Found</div>
            <div class="empty-description">Try adjusting your filters</div>
        </div>

        <!-- Pagination -->
        <div id="pagination"></div>
    </section>

</div>

<!-- Footer -->
<footer class="footer">
    <p>¬© 2024 LendScape. Building sustainable communities through sharing.</p>
</footer>

<script src="{{ url_for('static', filename='js/utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/top_users.js') }}"></script>
<script>
    // Toggle dropdown menu
    function toggleDropdown(event) {
        event.stopPropagation();
        const dropdown = document.getElementById('dropdownMenu');
        if (dropdown) {
            dropdown.classList.toggle('show');
        }
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function() {
        const dropdown = document.getElementById('dropdownMenu');
        if (dropdown) {
            dropdown.classList.remove('show');
        }
    });

    // Logout function
    async function logout() {
        if (!confirm('Are you sure you want to logout?')) {
            return;
        }

        try {
            const response = await fetch('/auth/logout', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            if (response.ok) {
                window.location.href = '/';
            } else {
                alert('Logout failed. Please try again.');
            }
        } catch (error) {
            alert('An error occurred: ' + error.message);
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadTopUsers();
    });
</script>

</body>
</html>