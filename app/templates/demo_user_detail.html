<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - LendScape</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">

</head>
<body>
<script src="{{ url_for('static', filename='js/utils.js')}}"></script>
<script src="{{ url_for('static', filename='js/users.js')}}"></script>
<!-- Hidden input for user ID -->
<input type="hidden" id="user-id" value="">

<!-- Navigation -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo">ğŸ“¦ LendScape</div>
        <div class="nav-menu">
            <a href="{{ url_for('main.index') }}">Home</a>
            <a href="#">Browse</a>
            <a href="#">Messages</a>
            <a href="#" class="active">Profile</a>
        </div>
        <div class="user-menu">
            <div class="notification-icon">
                ğŸ””
                <span class="notification-badge"></span>
            </div>
            <div class="user-avatar" id="nav-avatar">-</div>
        </div>
    </div>
</nav>

<div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="profile-card">
            <div class="profile-header" id="profile-card">
                <div class="profile-avatar" id="profile-avatar">-</div>
                <div class="profile-name" id="profile-name">Loading...</div>
                <div class="profile-username" id="profile-email">-</div>
            </div>
            <div class="profile-stats" id="profile-stats">
                <div class="stat">
                    <div class="stat-value" id="items-count">TBD</div>
                    <div class="stat-label">Lending</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-orders">0</div>
                    <div class="stat-label">Borrowing</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="user-rating">TBD</div>
                    <div class="stat-label">Rating</div>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="#" class="nav-link" data-section="items">
                <span class="nav-icon">ğŸ“¦</span>
                My Items
            </a>
            <a href="#" class="nav-link active" data-section="borrowing">
                <span class="nav-icon">ğŸ“¥</span>
                Borrowing (<span id="borrower-count">0</span>)
            </a>
            <a href="#" class="nav-link" data-section="lending">
                <span class="nav-icon">ğŸ“¤</span>
                Lending (<span id="lender-count">0</span>)
            </a>
            <a href="#" class="nav-link" data-section="requests">
                <span class="nav-icon">ğŸ“‹</span>
                Requests (TBD)
            </a>
            <a href="#" class="nav-link" data-section="settings">
                <span class="nav-icon">âš™ï¸</span>
                Settings
            </a>
        </nav>
    </div>
    <!-- Content Area -->
    <div class="content-area">
        <!-- Loading State -->
        <div id="loading" class="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Loading user data...</p>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="error-message"></div>

<!--         My Items Section (TBD) -->
        <div id="items-section" class="orders-section">
            <div class="content-header">
                <h1 class="content-title">My Items</h1>
                <button class="btn btn-primary">
                    <span>+</span> Add New Item
                </button>
            </div>

        </div>

        <!-- Borrowing Orders Section -->
        <div id="borrowing-section" class="orders-section active">
            <div class="content-header">
                <h1 class="content-title">My Borrowing Orders</h1>
                <button class="btn btn-primary" onclick="refreshUserDetail()">
                    ğŸ”„ Refresh
                </button>
            </div>
            <div id="borrower-orders-results"></div>
        </div>

        <!-- Lending Orders Section -->
        <div id="lending-section" class="orders-section">
            <div class="content-header">
                <h1 class="content-title">My Lending Orders</h1>
                <button class="btn btn-primary" onclick="refreshUserDetail()">
                    ğŸ”„ Refresh
                </button>
            </div>
            <div id="lender-orders-results"></div>
        </div>

        <!-- Other Sections (TBD) -->
        <div id="requests-section" class="orders-section">
            <div class="content-header">
                <h1 class="content-title">Requests</h1>
            </div>
            <div class="empty-state">
                <div class="empty-icon">ğŸ“‹</div>
                <div class="empty-title">TBD - Requests Feature</div>
                <div class="empty-description">This feature is under development</div>
            </div>
        </div>

        <div id="settings-section" class="orders-section">
            <div class="content-header">
                <h1 class="content-title">Settings</h1>
            </div>
            <div class="empty-state">
                <div class="empty-icon">âš™ï¸</div>
                <div class="empty-title">TBD - Settings Feature</div>
                <div class="empty-description">This feature is under development</div>
            </div>
        </div>
    </div>
</div>



</body>

<script>
// ç”¨æˆ·è¯¦æƒ…é¡µé¢åˆå§‹åŒ–è„šæœ¬
document.addEventListener('DOMContentLoaded', function() {
    console.log('User detail page loaded');

    // è·å–å½“å‰é¡µé¢è·¯å¾„
    const currentPath = window.location.pathname;
    console.log('Current path:', currentPath);

    // åˆ¤æ–­æ˜¯å¦æ˜¯ç”¨æˆ·è¯¦æƒ…é¡µ
    if (currentPath.match(/^\/users\/\d+$/)) {
        console.log('This is a user detail page');

        // è°ƒç”¨fetchUserDetailå‡½æ•°åŠ è½½ç”¨æˆ·æ•°æ®
        if (typeof fetchUserDetail === 'function') {
            fetchUserDetail();
        } else {
            console.error('fetchUserDetail function not found');
        }

        // ç»‘å®šä¾§è¾¹æ å¯¼èˆªäº‹ä»¶
        setupSidebarNavigation();
    } else {
        console.log('Not a user detail page');
    }
});

// è®¾ç½®ä¾§è¾¹æ å¯¼èˆª
function setupSidebarNavigation() {
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('.orders-section, .items-section');

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            // ç§»é™¤æ‰€æœ‰activeç±»
            navLinks.forEach(l => l.classList.remove('active'));
            sections.forEach(s => s.classList.remove('active'));

            // æ·»åŠ activeç±»åˆ°å½“å‰é“¾æ¥
            this.classList.add('active');

            // æ˜¾ç¤ºå¯¹åº”çš„section
            const sectionName = this.dataset.section;
            const section = document.getElementById(`${sectionName}-section`);
            if (section) {
                section.classList.add('active');
            }
        });
    });

    console.log('Sidebar navigation setup complete');
}
</script>